import{aC as r,aD as i,cL as j,aF as P,bx as E,a_ as V}from"./index-Ag4O5CUz.js";import{s as T,v as F}from"./rasterProjectionHelper-QCyizqub.js";import{p as L}from"./popupUtils-5pOMZLzx.js";const $=b=>{let e=class extends b{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return T(this.layer.rasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return F(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(o){return!!T(this.layer.rasterInfo,o)}async fetchPopupFeatures(o,R){const{layer:t}=this;if(!o)throw new E("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:d}=t,h=L(t,R);if(!d||h==null)throw new E("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:d,popupTemplate:h});const m=[],{value:l,magdirValue:n,processedValue:y}=await t.identify(o,{timeExtent:this.timeExtent});let u="";if(l&&l.length){u=t.type==="imagery-tile"&&t.hasStandardTime()&&l[0]!=null?l.map(c=>t.getStandardTimeValue(c)).join(", "):l.join(", ");const s={ObjectId:0},g="Raster.ServicePixelValue";s[g]=(y==null?void 0:y.join(", "))??u,s[g+".Raw"]=u;const w=t.rasterInfo.attributeTable;if(w!=null){const{fields:c,features:I}=w,x=c.find(({name:a})=>a.toLowerCase()==="value"),f=x?I.find(a=>String(a.attributes[x.name])===u):null;if(f)for(const a in f.attributes)f.attributes.hasOwnProperty(a)&&(s[this._rasterFieldPrefix+a]=f.attributes[a])}const v=t.rasterInfo.dataType;v!=="vector-magdir"&&v!=="vector-uv"||(s["Raster.Magnitude"]=n==null?void 0:n[0],s["Raster.Direction"]=n==null?void 0:n[1]);const p=new V(this.fullExtent.clone(),null,s);p.layer=t,p.sourceLayer=p.layer,m.push(p)}return m}};return r([i()],e.prototype,"layer",void 0),r([i(j)],e.prototype,"timeExtent",void 0),r([i()],e.prototype,"view",void 0),r([i()],e.prototype,"fullExtent",null),r([i()],e.prototype,"tileInfo",void 0),r([i({readOnly:!0})],e.prototype,"hasTilingEffects",null),r([i()],e.prototype,"datumTransformation",null),e=r([P("esri.views.layers.ImageryTileLayerView")],e),e};export{$ as p};
