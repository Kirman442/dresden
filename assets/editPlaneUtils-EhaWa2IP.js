import{cz as A,vJ as $t,vK as he,vL as ue,fL as w,hc as Mt,uF as B,jB as gt,pV as de,nG as jt,fJ as Qt,fI as ge,uH as ye,vM as ve,hb as St,a$ as ot,cB as me,cA as fe,vN as Yt,bt as Bt,fd as _e,aE as xe,lP as we,bp as Jt,nF as Te,vO as Oe,c_ as be,vP as $e,fK as yt,gb as Me,uY as It,vQ as Se,vR as Ie,vS as X,rW as Ve,rX as Ce,vT as vt,s5 as K,fG as mt,d5 as Vt,vU as Pe,vV as Re,g5 as Ct,vW as tt,vX as Xt,vY as Ge,vZ as De,fT as Ee,g6 as ze,v_ as ke,v$ as He,g4 as Fe,w0 as Ue,aC as s,aD as a,aF as M,aJ as Kt,e5 as Le,gv as O,g3 as et,lh as _t,w1 as te,jL as Ze,w2 as W,f_ as We,cH as xt,w3 as rt,gE as st,ey as Ae,aU as Z,w4 as Ne,aH as G,w5 as qe,a_ as je,aP as Pt,w6 as pt,ut as wt,gq as Qe,c8 as it,aA as Ye,w7 as Be,gI as Je,w8 as Xe,q5 as Ke,gL as ti,lB as Rt,mu as ei,c0 as ii,lM as Gt,l5 as ee,lA as ie,nK as ni,f7 as oi,jC as ri,uG as at,w9 as Dt,oJ as Et,wa as zt,qf as si,j6 as F,pN as q,s7 as kt,wb as ai,wc as li,gw as pi,nx as ct,ny as Ht}from"./index-Ag4O5CUz.js";import{t as j}from"./memoize-uBdPJ80n.js";import{simplify as ci,distance as hi}from"./geometryEngine-fH07TqLH.js";import{l as ui,d as ht,C as di}from"./InteractiveToolBase-ZS0Zg93l.js";import{i as ne}from"./measurementUtils-m_a_-ToD.js";import{s as N,p as gi,d as yi,a as ut,u as vi}from"./Tooltip-pDHIr1fy.js";import{o as Ft}from"./automaticAreaMeasurementUtils-E99ZXi2I.js";import{r as Ut}from"./dehydratedFeatureComparison-byYkTxmp.js";import{w as mi,V as fi,p as _i,l as xi,t as wi,a as Ti,s as Oi,c as bi}from"./EditGeometryOperations-b1tVyKkP.js";import{e as Lt}from"./SnappingContext-ylT1YTTy.js";import{p as $i,f as Mi}from"./SnappingOperation-WfZACanS.js";function nt(i,t,e=null){return e!=null?[i,t,e]:[i,t]}function m(i,t,e=null){return e!=null?{x:i,y:t,z:e}:{x:i,y:t}}let oe=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(e=>this.mapToLocal(e)).filter(ot)}get doUnnormalization(){return!1}},Si=class extends oe{constructor(t,e,n=null){super(e),this._defaultZ=n,this.transform=$t(),this.transformInv=$t(),this.transform=he(t),ue(this.transformInv,this.transform)}makeMapPoint(t,e){return nt(t,e,this._defaultZ)}mapToLocal(t){return m(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return nt(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},Ii=class extends oe{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=w(),this.tangentFrameUpWS=w(),this.tangentFrameRightWS=w(),this.tangentFrameForwardWS=w(),this.localFrameRightWS=w(),this.localFrameUpWS=w(),this.worldToLocalTransform=Mt(),this.localToWorldTransform=Mt(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const n=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,B.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,B.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,B.Z,this.tangentFrameForwardWS);const o=w();gt(o,this.tangentFrameForwardWS,de(n,this.tangentFrameForwardWS)),jt(this.localFrameRightWS,n,o),Qt(this.localFrameRightWS,this.localFrameRightWS),ge(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ye(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),ve(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,e){return nt(t,e,this.defaultZ)}mapToLocal(t){const e=w();this.view.renderCoordsHelper.toRenderCoords(new A({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),St(e,e,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,this.view.spatialReference);return n!=null?m(n.x/this.scale,n.y/this.scale):null}localToMap(t){const e=w();this.view.renderCoordsHelper.toRenderCoords(new A({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),St(e,e,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(e,this.view.spatialReference);return n!=null?nt(n.x,n.y,this.defaultZ):null}};function Zt(i,t){if(i.type==="2d")return new Si(i.state.transform,i.spatialReference,t.length>2?t[2]:null);if(i.type==="3d"){const e=t.length>2?new A({x:t[0],y:t[1],z:t[2],spatialReference:i.spatialReference}):new A({x:t[0],y:t[1],spatialReference:i.spatialReference});return new Ii(i,e)}return null}function z(i,t){const e=new A({x:i[0],y:i[1],spatialReference:t});return i.length>2&&(e.z=i[2]),e}function Vi(i,t){return new me({points:i,spatialReference:t})}function Wt(i,t,e){const n=new fe({paths:i,spatialReference:t});return e&&Yt(n),n}function k(i,t,e,n=!0){const o=Bt(i);o.forEach(l=>{const h=l[0],p=l[l.length-1];_e(h,p)&&l.length!==1||l.push(l[0])});let r=new xe({rings:o,spatialReference:t});return r.rings.forEach(l=>{we(l)||l.reverse()}),e&&Yt(r),n&&r.isSelfIntersecting&&Jt(t)&&(r=ci(r)),r}function At(i,t,e){const n=t.mapToLocalMultiple(i),o=[],r={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y},h=Math.round(l.x-r.x),p=Math.round(l.y-r.y),c=Math.max(Math.abs(h),Math.abs(p));if(e){const d={x:r.x+c,y:r.y+c},v={x:r.x-c,y:r.y-c};o.push(m(d.x,v.y),m(v.x,v.y),m(v.x,d.y),m(d.x,d.y))}else{const d={x:h>0?r.x+c:r.x-c,y:p>0?r.y+c:r.y-c};o.push(m(r.x,r.y),m(d.x,r.y),m(d.x,d.y),m(r.x,d.y))}return re(k([o.map(d=>t.localToMap(d)).filter(ot)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Ci(i,t,e){let n=t.mapToLocalMultiple(i);if(n.length===1){const p=n[0];n=[m(p.x-48,p.y+48),m(p.x+48,p.y-48),m(p.x+48,p.y-48),m(p.x-48,p.y+48)]}const o=[],r={x:n[0].x,y:n[0].y},l={x:n[1].x,y:n[1].y};if(e){const h=Math.round(l.x-r.x),p=Math.round(l.y-r.y);o.push(m(r.x-h,r.y-p),m(l.x,r.y-p),m(l.x,l.y),m(r.x-h,l.y))}else o.push(m(r.x,r.y),m(l.x,r.y),m(l.x,l.y),m(r.x,l.y));return re(k([o.map(h=>t.localToMap(h)).filter(ot)],t.spatialReference,t.doUnnormalization,!0),o,t)}function re(i,t,e){const n=Q(t[3],t[2],e),o=Q(t[1],t[2],e),r=Q(t[0],t[1],e),l=Q(t[0],t[3],e);return{geometry:i,midpoints:n!=null&&o!=null&&r!=null&&l!=null?{top:n,right:o,bottom:r,left:l}:null}}function Q(i,t,e){U[0]=i.x,U[1]=i.y,U[2]=0,L[0]=t.x,L[1]=t.y,L[2]=0,Te(U,U,L,.5),Y.x=U[0],Y.y=L[1],Y.z=L[2];const n=e.localToMap(Y);return n!=null?z(n,e.spatialReference):null}const Y=m(0,0,0),U=w(),L=w();function Nt(i,t,e,n){const o=t.mapToLocalMultiple(i);let r=null,l=null;if(e)r=o[0],l=o[1];else{const f=o[0],x=o[1],b=Math.round(x.x-f.x),H=Math.round(x.y-f.y),S=Math.max(Math.abs(b),Math.abs(H));r=m(b>0?f.x+S/2:f.x-S/2,H>0?f.y+S/2:f.y-S/2),l=m(Math.abs(b)>Math.abs(H)?r.x-S/2:r.x,Math.abs(b)>Math.abs(H)?r.y:r.y-S/2)}const h=t.localToMap(r),p=t.localToMap(l);if(h==null||p==null)return null;t.doUnnormalization&&Oe([[h,p]],t.spatialReference);const c=z(h,t.spatialReference),d=z(p,t.spatialReference),v=be(t.spatialReference);let u=0;if(Jt(t.spatialReference))u=v*hi(c,d,null);else{const f=r.x-l.x,x=r.y-l.y;u=v*Math.sqrt(f*f+x*x)*(n||1)}const T=new $e({center:c,radius:u,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:k(T.rings,T.spatialReference,!1),center:c,edge:d}}function Pi(i,t,e){const n=t.mapToLocalMultiple(i),o=n[0],r=n[1],l=Math.round(r.x-o.x),h=Math.round(r.y-o.y),p=m(e?o.x:o.x+l/2,e?o.y:o.y+h/2),c=e?l:l/2,d=e?h:h/2,v=60,u=[],T=2*Math.PI/v;function f(P){const pe=Math.cos(P),ce=Math.sin(P);return m(c*pe+p.x,d*ce+p.y)}for(let P=0;P<v;P++)u.push(f(P*T));u.push(u[0]);const{spatialReference:x,doUnnormalization:b}=t,H=k([u.map(P=>t.localToMap(P)).filter(ot)],x,b,!1),S=t.localToMap(f(Math.PI/2)),Tt=t.localToMap(f(0)),Ot=t.localToMap(f(-Math.PI/2)),bt=t.localToMap(f(Math.PI));return{geometry:H,midpoints:S!=null&&Tt!=null&&Ot!=null&&bt!=null?{top:z(S,x),right:z(Tt,x),bottom:z(Ot,x),left:z(bt,x)}:null}}const Ri=(()=>{const i=w(),t=w(),e=w();return(n,o)=>{if(yt(t,n.x,n.y,n.z??0),yt(e,o.x,o.y,o.z??0),Me(t,e))return null;if(!It(t,n.spatialReference,t)||!It(e,o.spatialReference,e)){jt(i,e,t),i[2]=0,Qt(i,i);let l=Se(Ie,i);return i[0]<0&&(l=2*Math.PI-l),X(l,"radians","geographic")}const{azimuth:r}=Ve(Di,t,e);return r!=null?X(r,"degrees","geographic"):void 0}})(),Gi=(()=>{const i=w(),t=w();return({x:e,y:n,z:o,spatialReference:r},l,h)=>{const p=o??0;yt(i,e,n,p);const c=vt(K(h.value,h.unit,"degrees"),h.rotationType,"geographic");if(!mt(i,r,i,Vt.WGS84)){const d=vt(c,"geographic","arithmetic"),v=K(d,"degrees","radians");return new A({x:e+l*Math.cos(v),y:n+l*Math.sin(v),z:p,spatialReference:r})}return Pe(t,i,c,l),t[2]=p,Re(t,Vt.WGS84,r)}})(),Di=new Ce;function Ei(i,t,e,n){if(!t)return;const{spatialReference:o}=i;if(!Ct(o))return;const r=ne(o),l=Ct(r);if(!l)return;const h=tt(i,e,n),p=Fi;if(!mt(h,o,p,r))return;const c=Xt(t,l);if((e==null?void 0:e.type)==="3d"&&e.viewingMode==="local")p[0]+=c;else{const v=Ge(r),u=De(v,p,B.X,Ui);Ee(p,p,u,c)}if(!mt(p,r,p,o))return;const d=ze(h,p);return new ke(h,d)}function zi(i,t,e,n){if(!t)return;const o=tt(i,e,n),r=Gi(i,1,t);if(!r)return;const l=tt(r,e,n);return new He(o,l)}function ki(i,t,e,n){if(i==null)return;const o=ne(t),r=Fe(o);return r?new Ue(Xt(i,r)):void 0}function Hi(i){let t;for(const e of i)e&&(t=(t==null?void 0:t.intersect(e))??e);return t}const Fi=w(),Ui=w();let _=class extends Kt{constructor(t){super(t),this.committed=null,this.disabled=!1,this.hidden=!1,this.id=Le(),this.inputValue=null,this.readOnly=!1}get dirty(){return this.inputValue!=null}get locked(){return this.committed!=null}lock(t){this.inputValue=null,this.committed=t??this.actual}unlock(){this.committed=null,this.inputValue=null}};s([a()],_.prototype,"actual",void 0),s([a()],_.prototype,"committed",void 0),s([a()],_.prototype,"createQuantity",void 0),s([a()],_.prototype,"disabled",void 0),s([a()],_.prototype,"hidden",void 0),s([a()],_.prototype,"format",void 0),s([a()],_.prototype,"id",void 0),s([a()],_.prototype,"inputValue",void 0),s([a()],_.prototype,"readOnly",void 0),s([a()],_.prototype,"suffix",void 0),s([a()],_.prototype,"title",void 0),s([a()],_.prototype,"toInputUnits",void 0),s([a()],_.prototype,"dirty",null),s([a()],_.prototype,"locked",null),_=s([M("esri.views.interactive.tooltip.fields.TooltipField")],_);let J=class extends _{constructor(t){super(t),this.mode="absolute-height"}normalizeCtorArgs(t){const e=n=>n.inputUnitInfos.verticalLength.unit;return{actual:O,createQuantity:(n,o)=>et(n,e(o)),toInputUnits:(n,o)=>_t(n,e(o)),format:(n,o)=>o.formatters.verticalLength(n),suffix:n=>n.inputUnitInfos.verticalLength.abbreviation,title:n=>n.messages.sketch.elevation,...t}}};s([a()],J.prototype,"mode",void 0),J=s([M("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],J);const se=i=>{const t=e=>e.inputUnitInfos.orientation.unit;return new _({actual:te,createQuantity:(e,n)=>X(e,t(n),"geographic"),toInputUnits:({value:e,unit:n,rotationType:o},r)=>{const p=vt(K(e,n,"degrees"),o,"geographic"),c=Ze.normalize(p,0,!0),d=t(r),v=K(c,"degrees",d);return X(v,d,"geographic")},format:(e,n)=>n.formatters.angle(e),suffix:e=>e.inputUnitInfos.orientation.abbreviation,title:e=>e.messages.sketch.orientation,...i})},ft=i=>{const t=e=>e.inputUnitInfos.length.unit;return new _({actual:O,createQuantity:(e,n)=>et(e,t(n)),toInputUnits:(e,n)=>_t(e,t(n)),format:(e,n)=>n.formatters.length(e),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...i})},lt=i=>new J(i),Li=i=>{const t=e=>e.inputUnitInfos.area.unit;return new _({actual:W,createQuantity:(e,n)=>We(e,t(n)),toInputUnits:(e,n)=>_t(e,t(n)),format:(e,n)=>n.formatters.area(e),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,...i})};let D=class extends N{constructor(t){super(t),this.type="draw-point",this.elevation=lt()}get allFields(){return[this.elevation]}};s([a()],D.prototype,"type",void 0),s([a()],D.prototype,"elevation",void 0),s([a()],D.prototype,"allFields",null),s([a()],D.prototype,"helpMessage",void 0),D=s([M("esri.views.interactive.tooltip.DrawPointTooltipInfo")],D);let $=class extends N{constructor(i){super(i),this.type="draw-polyline",this.orientation=se(),this.distance=ft({title:t=>t.messages.sketch.distance}),this.elevation=lt(),this.totalLength=ft({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.totalLength]}};s([a()],$.prototype,"type",void 0),s([a()],$.prototype,"orientation",void 0),s([a()],$.prototype,"distance",void 0),s([a()],$.prototype,"elevation",void 0),s([a()],$.prototype,"totalLength",void 0),s([a()],$.prototype,"allFields",null),s([a()],$.prototype,"helpMessage",void 0),$=s([M("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],$);let V=class extends N{constructor(t){super(t),this.type="draw-polygon",this.orientation=se(),this.distance=ft({title:e=>e.messages.sketch.distance}),this.elevation=lt(),this.area=Li({readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.area]}};s([a()],V.prototype,"type",void 0),s([a()],V.prototype,"distance",void 0),s([a()],V.prototype,"elevation",void 0),s([a()],V.prototype,"area",void 0),s([a()],V.prototype,"allFields",null),s([a()],V.prototype,"helpMessage",void 0),V=s([M("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],V);let E=class extends N{constructor(t){super(t),this.type="draw-mesh",this.elevation=lt()}get allFields(){return[this.elevation]}};s([a()],E.prototype,"type",void 0),s([a()],E.prototype,"elevation",void 0),s([a()],E.prototype,"allFields",null),s([a()],E.prototype,"helpMessage",void 0),E=s([M("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],E);let R=class extends N{constructor(t){super(t),this.type="draw-rectangle",this.xSize=O,this.ySize=O,this.area=W}get allFields(){return[]}};s([a()],R.prototype,"type",void 0),s([a()],R.prototype,"xSize",void 0),s([a()],R.prototype,"ySize",void 0),s([a()],R.prototype,"area",void 0),s([a()],R.prototype,"allFields",null),R=s([M("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],R);let C=class extends N{constructor(i){super(i),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=W}get allFields(){return[]}};s([a()],C.prototype,"type",void 0),s([a()],C.prototype,"radius",void 0),s([a()],C.prototype,"xSize",void 0),s([a()],C.prototype,"ySize",void 0),s([a()],C.prototype,"area",void 0),s([a()],C.prototype,"allFields",null),C=s([M("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],C);class Zi{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let g=class extends xt.EventedMixin(ui){constructor(i){super(i),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new rt,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new st,this._getPointConstraint=j(t=>t),this._getPolylineOrPolygonConstraint=j((t,e,n)=>Hi([t,e,n])),this._getDistanceConstraint=j(Ei),this._getOrientationConstraint=j(zi),this._getElevationConstraint=j(ki)}initialize(){this.internalGraphicsLayer=new Ae({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation();const i=this.tooltipOptions,t=this.view.type;this.tooltipInfos={point:new D({tooltipOptions:i,viewType:t}),polyline:new $({tooltipOptions:i,viewType:t}),polygon:new V({tooltipOptions:i,viewType:t}),mesh:new E({tooltipOptions:i,viewType:t}),rectangle:new R({tooltipOptions:i}),circle:new C({tooltipOptions:i})},this.addHandles([this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e)),Z(()=>this.cursor,e=>{this.drawOperation.cursor=e},it),Z(()=>this.tooltipOptions.enabled,e=>{this.tooltip=e?new vi({view:this.view,info:this._tooltipInfo}):G(this.tooltip)},it),Ne(()=>this._updateTooltipInfo())]),this.finishToolCreation()}destroy(){this.drawOperation=G(this.drawOperation),this.tooltip=G(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=G(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return et(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(i){this._set("centered",i),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(i){this._set("cursor",i)}set enabled(i){this.drawOperation.interactive=i,this._set("enabled",i)}set forceUniformSize(i){this._set("forceUniformSize",i),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(i){this._set("graphicSymbol",i),this._graphic!=null&&(this._graphic.symbol=i)}get updating(){var i;return((i=this.drawOperation)==null?void 0:i.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(i){const t=this._tooltipInfo;if(i.type==="key-down"&&i.key===qe.enterInputMode&&t!=null&&t.editableFields.length>0&&this.tooltipOptions.inputEnabled)return t.enterInputMode(),void i.stopPropagation();this.drawOperation.onInputEvent(i)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.removeHandles(I.outline),this.removeHandles(I.regularVertices),this.removeHandles(I.activeVertex),this.removeHandles(dt)}_createOrUpdateGraphic(i){if(this._graphic!=null)return this.updateGraphicGeometry(this._graphic,i),this._graphic;const t=this._graphic=new je({...this.graphicProperties,symbol:this.graphicSymbol});return this.updateGraphicGeometry(t,i),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(Pt(()=>{this.internalGraphicsLayer.remove(t),G(t),this._graphic===t&&(this._graphic=null)}),dt),t}updateGraphicGeometry(i,t){i.geometry=t}_getCreateOperationGeometry(i={operationComplete:!1}){var T;const{drawOperation:t}=this;if(t==null||t.numVertices===0)return null;const{coordinateHelper:e,view:n}=t,o=t.stagedVertex,r=t.committedVertices,l=r.slice(),h=o!=null;h&&l.push(e.pointToArray(o));const p=h?e.pointToArray(o):r.splice(-1)[0],c=l.length,d=n.spatialReference,v=n.type==="3d"&&n.viewingMode==="global",u=new Zi;switch(this.geometryType){case"point":case"mesh":u.regularVertices=r,u.activeVertex=p,u.full=e.arrayToPoint(l[0]);break;case"multipoint":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=Vi(l,d));break;case"polyline":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=Wt([l],d,v));break;case"polygon":u.regularVertices=r,u.activeVertex=p,c>0&&(u.full=k([l],d,v,!0));break;case"circle":if(c>0){const f=Zt(n,l[0]);if(c===1&&i.operationComplete){const x=l[0],b=f.makeMapPoint(x[0]+qt*n.resolution,x[1]);u.circle=Nt([x,b],f,!0),u.full=u.circle!=null?u.circle.geometry:null}else c===2&&(this.forceUniformSize?(u.circle=Nt(l,f,this.centered),u.full=u.circle!=null?u.circle.geometry:null):(u.rectangle=Pi(l,f,this.centered),u.full=u.rectangle.geometry))}break;case"rectangle":if(c>0){const f=Zt(n,l[0]);if(c===1&&i.operationComplete){const x=l[0],b=f.makeMapPoint(x[0]+qt*n.resolution,x[1]);u.rectangle=At([x,b],f,!0),u.full=u.rectangle.geometry}else c===2&&(u.rectangle=this.forceUniformSize?At(l,f,this.centered):Ci(l,f,this.centered),u.full=u.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":u.outline=c>1?Wt([l],d,v):null;break;case"polygon":u.outline=c>1?k([l],d,v):null;break;case"circle":case"rectangle":u.outline=((T=u.full)==null?void 0:T.type)==="polygon"?k(u.full.rings,d,v):null}return u}initializeGraphic(i){return Pt()}onComplete(i){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...i})}onCursorUpdate(i){this._updateGraphic(),this.emit("cursor-update",i)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(i){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-add",i)}onVertexRemove(i){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-remove",i)}onVertexUpdate(i){this._updateGraphic(),this.emit("vertex-update",i)}_updateGraphic(){const i=this._getCreateOperationGeometry();this._createOperationGeometry=i,i!=null?(i.outline!=null?this.addHandles(this.onOutlineChanged(i.outline),I.outline):this.removeHandles(I.outline),i.regularVertices!=null?this.addHandles(this.onRegularVerticesChanged(i.regularVertices),I.regularVertices):this.removeHandles(I.regularVertices),i.activeVertex!=null?this.addHandles(this.onActiveVertexChanged(i.activeVertex),I.activeVertex):this.removeHandles(I.activeVertex),i.full!=null?this._createOrUpdateGraphic(i.full):this.removeHandles(dt)):this._destroyAllVisualisations()}get _tooltipInfo(){var r;const{drawOperation:i,graphic:t,view:e}=this;if(!i)return null;const n=this.tooltipInfos,o=(r=t==null?void 0:t.geometry)==null?void 0:r.type;switch(this.geometryType){case"point":return e.type==="2d"&&this.defaultZ===0?null:o==="point"?n.point:null;case"polyline":return o==="polyline"?n.polyline:null;case"polygon":return o==="polygon"?n.polygon:null;case"rectangle":return o==="polygon"?n.rectangle:null;case"circle":return o==="polygon"?n.circle:null;case"mesh":return o==="mesh"?n.mesh:null;default:return null}}_updateTooltipInfo(){const{_tooltipInfo:i,tooltip:t}=this;if(i&&t){switch(i.type){case"draw-point":this._updateDrawPointTooltipInfo(i);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(i);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(i);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(i);break;case"draw-circle":this._updateDrawCircleTooltipInfo(i);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(i)}t.info=i}}_updateDrawPointTooltipInfo(i){const{drawOperation:t,graphic:e,view:n,tooltipOptions:o}=this,{elevationInfo:r,stagedVertex:l}=t;if(i.tooltipOptions=o,i.viewType=n.type,i.helpMessage=pt("point",e==null?void 0:e.geometry),this.updateElevation(i.elevation),!l)return void(t.constraint=void 0);const h=t.coordinateHelper.spatialReference;t.constraint=this._getPointConstraint(this._getElevationConstraint(i.elevation.committed,h,n,r))}_updateDrawPolylineTooltipInfo(i){const t=this._createOperationGeometry,e=t!=null?t.full:null;if((e==null?void 0:e.type)!=="polyline")return;const{drawOperation:n,tooltipOptions:o,view:r}=this,{lastVertex:l,stagedVertex:h}=n;this._updatePolylineOrPolygonCommon(i,h);const p=gi(e,this._elevationMode);i.totalLength.actual=p??O,i.totalLength.hidden=length==null||!l,i.tooltipOptions=o,i.viewType=r.type,i.helpMessage=pt("polyline",e),this.updateElevation(i.elevation)}_updateDrawPolygonTooltipInfo(i){const t=this._createOperationGeometry,e=t!=null?t.full:null;if((e==null?void 0:e.type)!=="polygon")return;const{drawOperation:n,tooltipOptions:o,view:r}=this,{lastVertex:l}=n;let h=n.stagedVertex;(e==null?void 0:e.type)==="polygon"&&l&&!h&&(h=e.getPoint(0,e.rings[0].length-1)),this._updatePolylineOrPolygonCommon(i,h);const p=Ft(e,this._elevationMode);i.area.actual=p??W,i.area.hidden=p==null&&!l,i.tooltipOptions=o,i.viewType=r.type,i.helpMessage=pt("polygon",e),this.updateElevation(i.elevation)}_updatePolylineOrPolygonCommon(i,t){const{view:e,drawOperation:n}=this,{elevationInfo:o,lastVertex:r}=n;if(!r||!t)return i.distance.hidden=!0,i.orientation.hidden=!0,void(n.constraint=void 0);const l=yi(r,t,this._elevationMode);i.distance.actual=l??O,i.distance.hidden=!1;const h=Ri(r,t);i.orientation.actual=h??te,i.orientation.hidden=!1;const p=n.coordinateHelper.spatialReference;n.constraint=this._getPolylineOrPolygonConstraint(this._getDistanceConstraint(r,i.distance.committed,e,o),this._getOrientationConstraint(r,i.orientation.committed,e,o),this._getElevationConstraint(i.elevation.committed,p,e,o))}updateDrawMeshTooltipInfo(i){}_updateDrawRectangleTooltipInfo(i){i.tooltipOptions=this.tooltipOptions,i.xSize=this._xSize??O,i.ySize=this._ySize??O,i.area=this._fullGeometryArea??W}_updateDrawCircleTooltipInfo(i){const{forceUniformSize:t}=this;i.tooltipOptions=this.tooltipOptions,i.radius=t?this._circleRadius??O:null,i.xSize=t?null:this._xSize??O,i.ySize=t?null:this._ySize??O,i.area=this._fullGeometryArea??W}get _circleRadius(){var t;const i=this._createOperationGeometry;return((t=i==null?void 0:i.circle)==null?void 0:t.center)!=null&&i.circle.edge!=null?ut(i.circle.center,i.circle.edge,this._elevationMode):null}get _xSize(){var t,e;const i=(e=(t=this._createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:e.midpoints;return i!=null?ut(i.left,i.right,this._elevationMode):null}get _ySize(){var t,e;const i=(e=(t=this._createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:e.midpoints;return i!=null?ut(i.top,i.bottom,this._elevationMode):null}get _fullGeometryArea(){var t;const i=(t=this._createOperationGeometry)==null?void 0:t.full;return(i==null?void 0:i.type)!=="polygon"?null:Ft(i,this._elevationMode)}updateElevation(i){i.actual=this._vertexTooltipElevation}get _vertexTooltipElevation(){const{tooltipOptions:i,view:t,drawOperation:e}=this;if(e==null)return this._defaultElevation;const n=e.stagedVertex??e.lastVertex;if(n==null||t.type==="2d")return this._defaultElevation;const o={mode:i.elevation.mode,offset:0},r=(wt(t,n,e.elevationInfo,o)??0)*Qe(n.spatialReference);return et(r,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}_clearConstraints(){for(const[,i]of Object.entries(this.tooltipInfos))i.unlockAllFields()}};s([a()],g.prototype,"_createOperationGeometry",void 0),s([a()],g.prototype,"_defaultElevation",null),s([a({value:!0})],g.prototype,"centered",null),s([a()],g.prototype,"cursor",null),s([a({nonNullable:!0})],g.prototype,"defaultZ",void 0),s([a()],g.prototype,"drawOperation",void 0),s([a({value:!0})],g.prototype,"enabled",null),s([a({value:!0})],g.prototype,"forceUniformSize",null),s([a({constructOnly:!0})],g.prototype,"geometryType",void 0),s([a()],g.prototype,"graphic",null),s([a({constructOnly:!0})],g.prototype,"graphicProperties",void 0),s([a()],g.prototype,"graphicSymbol",null),s([a({constructOnly:!0})],g.prototype,"hasZ",void 0),s([a({constructOnly:!0,type:rt})],g.prototype,"labelOptions",void 0),s([a({constructOnly:!0})],g.prototype,"geometryToPlace",void 0),s([a({constructOnly:!0})],g.prototype,"mode",void 0),s([a()],g.prototype,"snappingManager",void 0),s([a()],g.prototype,"snapToScene",void 0),s([a()],g.prototype,"tooltip",void 0),s([a()],g.prototype,"tooltipInfos",void 0),s([a({constructOnly:!0,type:st})],g.prototype,"tooltipOptions",void 0),s([a({readOnly:!0})],g.prototype,"type",void 0),s([a({readOnly:!0})],g.prototype,"updating",null),s([a({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0),s([a()],g.prototype,"_tooltipInfo",null),s([a()],g.prototype,"_circleRadius",null),s([a()],g.prototype,"_xSize",null),s([a()],g.prototype,"_ySize",null),s([a()],g.prototype,"_fullGeometryArea",null),s([a()],g.prototype,"_vertexTooltipElevation",null),s([a()],g.prototype,"_elevationMode",null),g=s([M("esri.views.draw.DrawGraphicTool")],g);const dt="create-operation-graphic",I={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function mn(i){switch(i){case"point":case"polyline":case"polygon":case"multipoint":return i;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const qt=48,ae="click";class Wi{constructor({grabbableForEvent:t}){this.events=new xt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=!0,this.grabbableForEvent=t}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const Ai="crosshair",Ni="progress";let y=class extends xt.EventedMixin(Kt){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this._stagedPointerId=null,this._updatingHandles=new Ye,this.constraint=void 0,this.isDraped=!0,this.labelOptions=new rt,this.tooltipOptions=new st,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Be(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,o="viewingMode"in e.state?e.state.viewingMode:Je.Local,r=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=mi(this.hasZ,this.hasM,n),this._editGeometryOperations=new fi(new _i(r,this.coordinateHelper)),this._snappingOperation=new $i({view:e,constrainResult:p=>{var c;return p?(c=this._getEffectiveDrawSurface())==null?void 0:c.constrainZ(p):void 0}}),this.addHandles([Z(()=>this.stagedVertex,p=>{p!=null&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(p)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(p,c)=>ei(p,c,Ut)}),Z(()=>this.view.viewpoint,(p,c)=>{p&&c&&ii(p,c)&&this._onViewpointChange()})]),this._activeComponent=new xi(n,o),this._editGeometryOperations.data.components.push(this._activeComponent);const l=this.segmentLabels;l!=null&&(l.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([Z(()=>this.labelOptions.enabled,p=>{l.visible=p},it),this.on("cursor-update",()=>{const p=this.stagedVertex;l.stagedVertex=p!=null?this.coordinateHelper.pointToVector(p):null})])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],p=>{const c=p.vertices.map(T=>({componentIndex:0,vertexIndex:T.index,coordinates:this.coordinateHelper.vectorToArray(T.pos)})),d=c.map(T=>T.coordinates);switch(p.type){case"vertex-add":this.emit(p.type,{...p,added:d,vertices:c});break;case"vertex-update":this.emit(p.type,{...p,updated:d,vertices:c});break;case"vertex-remove":this.emit(p.type,{...p,removed:d,vertices:c})}const v=this._activeComponent.getLastVertex(),u=v!=null?this.coordinateHelper.vectorToDehydratedPoint(v.pos):null;u!=null&&this.lastVertex!=null&&Ut(this.lastVertex,u)||(this.lastVertex=u)}));const h=this._manipulator=new Wi({grabbableForEvent:p=>this.drawingMode!=="click"||p.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(h),h.grabbable=t!=="point",this.addHandles([this._createManipulatorDragPipeline(h),h.events.on("immediate-click",p=>this._onImmediateClick(p)),h.events.on("immediate-double-click",p=>this._onImmediateDoubleClick(p)),Z(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:p})=>{h.cursor=p},it)]),Xe(this,()=>{const p=this.view.inputManager.latestPointerType??"mouse",c=this._getSnappingContext(p);this.snappingManager!=null&&this._updatingHandles.addPromise(Rt(this._snappingOperation.resnap(this.snappingManager,c)))})}destroy(){G(this.segmentLabels),G(this._snappingOperation),this._editGeometryOperations=G(this._editGeometryOperations),this._updatingHandles.destroy()}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??ae)}get effectiveCursor(){return this.loading?Ni:this._hideDefaultCursor?null:this.cursor||Ai}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return this.stagedVertex!=null?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get stagedVertex(){const t=this._snappingOperation.stagedPoint,{constraint:e,elevationInfo:n,view:o}=this;if(!t||!e)return t;const r=tt(t,o,n),l=r?e.closestTo(r):void 0;return l?Ke(l,t.spatialReference):t}set stagedVertex(t){this._snappingOperation.stagedPoint=Bt(t)}get updating(){return this._updatingHandles.updating}get vertices(){const t=this.committedVertices;return this.stagedVertex!=null&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),this.stagedVertex!=null){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const e=t&&t.aborted||!1;this._snappingOperation.abort(),this.snappingManager!=null&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const n=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map((o,r)=>({componentIndex:0,vertexIndex:r,coordinates:o})),aborted:e,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const e=this._activeComponent;if(this.geometryType==="polygon"&&e.vertices.length>2){if(this._vertexWithinPointerDistance(e.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(e.vertices[e.vertices.length-1].pos,t))return e.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return ht(t,(e,n,o,r)=>{const l=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!l)return;const{snappingStep:h,cancelSnapping:p}=Mi({predicate:()=>l,snappingManager:this.snappingManager,snappingContext:new Lt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next(c=>(l&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),c)).next(p),n.next(this._screenToMapDragEventStep()).next(c=>(c.action==="start"&&(this.stagedVertex=c.mapStart,(this.geometryType==="segment"||l&&this.numVertices===0)&&this.commitStagedVertex()),c)).next(di(this.view,this.elevationInfo)).next(...h).next(c=>(l&&(this.stagedVertex=c.mapEnd,c.action==="end"&&this.commitStagedVertex()),c)).next(c=>(c.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),c))})}_createManipulatorDragPipelineFreehand(t){return ht(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return ht(t,(e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(this.elevationDrawSurface==null)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,e=!1;return this.elevationInfo!=null&&this.elevationInfo.mode==="absolute-height"&&(e=!0),this.snapToSceneEnabled!=null&&(e=this.snapToSceneEnabled),this.elevationInfo!=null&&this.elevationInfo.mode==="on-the-ground"&&(e=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),e=!1),e?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const e=this._activeComponent;if(this._closeOnClickVertexIndex(t.screenPoint)!=null)return t.stopPropagation(),void this.complete();const n=this._screenToMap(t.screenPoint);if(n!=null)switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),(this.geometryType==="point"||this.geometryType==="segment"&&e.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&e.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=ti(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId;const n=this._snappingOperation,o=this._manipulator;this._pointerDownStates.has(t.pointerId)||o.grabbing||!o.interactive?n.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(e,t.pointerType))}_onViewpointChange(){const t=this._manipulator;this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._pointerDownStates.has(this._stagedPointerId)&&!t.grabbing&&t.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,e){var c;const n=this._snappingOperation,o=this._closeOnClickVertexIndex(t);if(o!=null)return this._closeOnVertex(o),void n.abort();const r=this._screenToMap(t),l=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(t):null;if(r==null)return this._hideDefaultCursor=!0,void n.abort();this._hideDefaultCursor=!1;const h=this.snappingManager;if(h==null)return this.stagedVertex=r,void n.abort();const p=this._getSnappingContext(e);this._updatingHandles.addPromise(Rt(n.snap({point:r,scenePoint:l},h,p)))}_closeOnVertex(t){this.stagedVertex=null;const e={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}_screenToMap(t){var e;return(e=this._getEffectiveDrawSurface())==null?void 0:e.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const n=this._screenToMap(e.screenEnd);return n!=null?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&qi(o,e,25)}_getSnappingContext(t){var n;const e=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new Lt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null})}};function qi(i,t,e){const n=i.x-t.x,o=i.y-t.y;return n*n+o*o<=e}s([a()],y.prototype,"_hideDefaultCursor",void 0),s([a()],y.prototype,"_snappingOperation",void 0),s([a()],y.prototype,"_snappingEnabled",null),s([a({constructOnly:!0})],y.prototype,"graphic",void 0),s([a()],y.prototype,"constraint",void 0),s([a()],y.prototype,"defaultZ",void 0),s([a()],y.prototype,"isDraped",void 0),s([a({value:ae})],y.prototype,"drawingMode",null),s([a({constructOnly:!0})],y.prototype,"elevationDrawSurface",void 0),s([a({constructOnly:!0})],y.prototype,"elevationInfo",void 0),s([a({constructOnly:!0,type:rt})],y.prototype,"labelOptions",void 0),s([a({constructOnly:!0,type:st})],y.prototype,"tooltipOptions",void 0),s([a({constructOnly:!0})],y.prototype,"geometryType",void 0),s([a({constructOnly:!0})],y.prototype,"hasM",void 0),s([a({constructOnly:!0})],y.prototype,"hasZ",void 0),s([a()],y.prototype,"cursor",void 0),s([a()],y.prototype,"effectiveCursor",null),s([a()],y.prototype,"loading",void 0),s([a({constructOnly:!0})],y.prototype,"manipulators",void 0),s([a({constructOnly:!0})],y.prototype,"drawSurface",void 0),s([a({constructOnly:!0})],y.prototype,"segmentLabels",void 0),s([a({constructOnly:!0})],y.prototype,"snappingManager",void 0),s([a({constructOnly:!0})],y.prototype,"snappingVisualizer",void 0),s([a()],y.prototype,"snapToSceneEnabled",void 0),s([a()],y.prototype,"stagedVertex",null),s([a()],y.prototype,"lastVertex",void 0),s([a()],y.prototype,"updating",null),s([a({constructOnly:!0})],y.prototype,"view",void 0),y=s([M("esri.views.draw.DrawOperation")],y);class _n{constructor(t,e,n,o=null){this._elevationInfo=t,this.defaultZ=e,this._view=n,this._excludeGraphics=o}screenToMap(t){if(this.defaultZ!=null)return this._view.sceneIntersectionHelper.intersectElevationFromScreen(Gt(t.x,t.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const e=this._view.sceneIntersectionHelper.intersectElevationFromScreen(Gt(t.x,t.y),this._elevationInfo,0,this._excludeGraphics);return e!=null&&(e.z=void 0),e}mapToScreen(t){const e=ee(t.x,t.y,wt(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(e)}constrainZ(t){const{defaultZ:e}=this;return e!=null&&t.z!==e&&((t=ie(t)).z=e),t}}class xn{constructor(t,e,n=[]){this.view=t,this.elevationInfo=e,this.exclude=n}screenToMap(t){const e=this.view.toMap(t,{exclude:this.exclude});return e!=null&&(e.z=ni(e,this.view,this.elevationInfo)),e}mapToScreen(t){let e=t;return this.elevationInfo!=null&&(e=ee(t.x,t.y,wt(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(e)}constrainZ(t){return t}}class wn{constructor(t,e=!1,n=0){this.view=t,this.hasZ=e,this.defaultZ=n,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=e?o=>{const r=t.toMap(o);return r.z=n,r}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=ie(t)).z=e),t}}function Tn(i,t){return le(i,t,!1)}function On(i,t){return le(i,t,!0)}function le(i,t,e){if(i instanceof wi){if(i.operation instanceof Ti)return ji(i.operation,t,e),!0;if(i.operation instanceof Oi)return Qi(i.operation,t,e),!0;if(i.operation instanceof bi)return Yi(i.operation,t,e),!0}return!1}function ji(i,t,e=!1){const n=e?-1:1,o=oi(n*i.dx,n*i.dy,n*i.dz);ri(t.origin,t.origin,o),at(t)}function Qi(i,t,e=!1){const n=e?-i.angle:i.angle;Dt(t.basis1,t.basis1,Et,n),Dt(t.basis2,t.basis2,Et,n),at(t)}function Yi(i,t,e=!1){const n=e?1/i.factor1:i.factor1,o=e?1/i.factor2:i.factor2;gt(t.basis1,t.basis1,n),gt(t.basis2,t.basis2,o),zt(t.origin,t.origin,i.origin,i.axis1,n),zt(t.origin,t.origin,i.origin,i.axis2,o),at(t)}function bn(i,t,e,n){n||(n=si());const o=F(q.get(),i[1],-i[0]),r=F(q.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=F(q.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=q.get();t.components.forEach(d=>d.vertices.forEach(v=>{const u=v.pos;F(h,kt(i,u),kt(o,u)),ai(r,r,h),li(l,l,h)}));const p=1e-6,c=F(q.get(),l[0]-r[0]<p?e/2:0,l[1]-r[1]<p?e/2:0);return pi(r,r,c),ct(l,l,c),Ht(n.basis1,i,(l[0]-r[0])/2),Ht(n.basis2,o,(l[1]-r[1])/2),F(n.origin,r[0]*i[0]+r[1]*o[0],r[0]*i[1]+r[1]*o[1]),ct(n.origin,n.origin,n.basis1),ct(n.origin,n.origin,n.basis2),at(n),n}export{g as K,Tn as V,mn as X,wn as c,lt as g,y as k,bn as l,xn as o,_n as r,On as x};
